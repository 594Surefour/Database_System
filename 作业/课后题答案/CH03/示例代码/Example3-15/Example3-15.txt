create database library;
use library;
create table book(
  bookid int auto_increment primary key,
  bookname varchar(60) not null,
  author varchar(40) not null,
  publisher varchar(60) not null,
  price float(8,2) not null,
  intime timestamp,
  isdelete tinyint default 0
);


create table reader(
  readerid int auto_increment primary key,
  readername varchar(40) not null,
  readersex varchar(4) not null,
  paperid varchar(20) not null,
  telephone varchar(20),
  createdate timestamp
);


create table borrow(
  borrowid int auto_increment primary key,
  readerid int,
  bookid int,
  borrowdate date not null,
  givebackdate date not null,
  isback tinyint default 0,
  constraint borrow_reader_fk foreign key(readerid) 
     references reader(readerid) on delete cascade,
  constraint borrow_book_fk foreign key(bookid) references book(bookid)
);


create table giveback(
  givebackid int auto_increment primary key,
  readerid int not null,
  bookid int not null,
  givebackdate date not null,
  constraint giveback_reader_fk foreign key(readerid) references reader(readerid)
    on delete cascade,
  constraint giveback_book_fk foreign key(bookid) references book(bookid)
);


insert into book values(
  null,'Java Web开发与实践','高翔','人民邮电出版社',59.80,default,default
);
insert into book values(
  null,'Oracle数据库','杨少敏','清华大学出版社',39.00,default,default
);
insert into book values(
  null,'计算机应用基础','焦家林','清华大学出版社',32.50,default,default
);
insert into book values(
  null,'Servlet/JSP深入详解','孙鑫','电子工业出版社',75.00,default,default
);


insert into reader values(
  null,'谢丹丹','女','210102197507041211',default,default);
insert into reader values(
  null,'李冰','男','210104198510202124','13523457891',default);


insert into borrow values(
  null,'1','3',curdate(),date_add(curdate(),interval 60 day),default);
insert into borrow values(
  null,'1','4',curdate(),date_add(curdate(),interval 60 day),default);


insert into giveback values( null,'1','3','2016-07-12');
insert into giveback values( null,'1','4','2016-07-12');
update borrow set isback=1 where readerid='1' and bookid='3';
update borrow set isback=1 where readerid='1' and bookid='4';


delete from reader where readerid='1';